# SealBid æ¶æ„è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

SealBid æ˜¯ä¸€ä¸ªåŸºäº Sui åŒºå—é“¾å’Œ Seal æ—¶é—´é”åŠ å¯†çš„å»ä¸­å¿ƒåŒ–éšç§æ‹å–å¹³å°ã€‚æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†ç³»ç»Ÿçš„æ¶æ„è®¾è®¡ã€æ•°æ®æµå’Œå…³é”®æŠ€æœ¯å†³ç­–ã€‚

## ğŸ›ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·ç•Œé¢                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ åˆ›å»ºä»£å¸ â”‚  â”‚ åˆ›å»ºæ‹å– â”‚  â”‚ æäº¤å‡ºä»· â”‚  â”‚ æŸ¥çœ‹ç»“æœ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚             â”‚             â”‚
        â–¼             â–¼             â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯åº”ç”¨å±‚ (React)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Sui SDK  â”‚  Seal SDK  â”‚  Wallet Kit  â”‚  State Mgmt â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Sui åŒºå—é“¾                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ coin_factory â”‚  â”‚   auction    â”‚  â”‚seal_integrationâ”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Seal æœåŠ¡å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Key Server 1â”‚  â”‚  Key Server 2â”‚  â”‚  Key Server Nâ”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ æ ¸å¿ƒæµç¨‹

### 1. ä»£å¸åˆ›å»ºæµç¨‹

```
ç”¨æˆ·è¾“å…¥ä»£å¸ä¿¡æ¯
    â†“
éƒ¨ç½²åŒ…å« OTW çš„æ¨¡å—
    â†“
è°ƒç”¨ coin_factory::create_coin
    â†“
åˆ›å»º TreasuryCap å’Œ CoinMetadata
    â†“
å°†ä»£å¸æ³¨å†Œåˆ° CoinRegistry
    â†“
è¿”å› TreasuryCap ç»™åˆ›å»ºè€…
```

### 2. æ‹å–åˆ›å»ºæµç¨‹

```
ç”¨æˆ·è®¾ç½®æ‹å–å‚æ•°
    â†“
éªŒè¯å‚æ•°æœ‰æ•ˆæ€§
    â†“
è°ƒç”¨ auction::create_auction
    â†“
åˆ›å»º Auction å¯¹è±¡
    â†“
å­˜å‚¨ TreasuryCap
    â†“
å‘å‡º AuctionCreated äº‹ä»¶
    â†“
å…±äº« Auction å¯¹è±¡
```

### 3. å‡ºä»·æµç¨‹ï¼ˆæ ¸å¿ƒï¼‰

```
ç”¨æˆ·å¡«å†™å‡ºä»·é‡‘é¢
    â†“
å‰ç«¯ä½¿ç”¨ Seal åŠ å¯†
    â”‚
    â”œâ”€ ç”Ÿæˆ keyId = BCS(end_time)
    â”‚
    â”œâ”€ è°ƒç”¨ Seal SDK åŠ å¯†å‡ºä»·
    â”‚
    â””â”€ å¾—åˆ°åŠ å¯†æ•°æ®
    â†“
æäº¤äº¤æ˜“åˆ°é“¾ä¸Š
    â”‚
    â”œâ”€ ä¼ å…¥åŠ å¯†æ•°æ®
    â”‚
    â”œâ”€ é™„å¸¦ SUI ä¿è¯é‡‘
    â”‚
    â””â”€ å­˜å‚¨åˆ° Auction å¯¹è±¡
    â†“
å‘å‡º BidPlaced äº‹ä»¶
```

### 4. æ‹å–å®Œæˆå’Œåˆ†é…æµç¨‹

```
ç­‰å¾…ç»“æŸæ—¶é—´åˆ°è¾¾
    â†“
åˆ›å»ºè€…è°ƒç”¨ finalize_auction
    â†“
éªŒè¯æ—¶é—´å’Œæƒé™
    â†“
æ ‡è®°æ‹å–ä¸ºå·²å®Œæˆ
    â†“
å‘å‡º AuctionFinalized äº‹ä»¶
    â†“
è§£å¯†æ‰€æœ‰å‡ºä»·
    â”‚
    â”œâ”€ è°ƒç”¨ Seal æœåŠ¡
    â”‚
    â”œâ”€ éªŒè¯è®¿é—®ç­–ç•¥ (seal_approve)
    â”‚
    â””â”€ è·å–è§£å¯†åçš„å‡ºä»·
    â†“
æ ¹æ®ç­–ç•¥æ’åºé€‰æ‹©ä¸­æ ‡è€…
    â”‚
    â”œâ”€ TOP_N: æŒ‰é‡‘é¢é™åº
    â”‚
    â”œâ”€ RANDOM_N: éšæœºé€‰æ‹©
    â”‚
    â””â”€ CLOSEST_TO_AVG: è®¡ç®—å¹³å‡å€¼
    â†“
åˆ†é…ä»£å¸ç»™ä¸­æ ‡è€…
    â†“
é€€æ¬¾ç»™æœªä¸­æ ‡è€…
```

## ğŸ” Seal æ—¶é—´é”åŠ å¯†è®¾è®¡

### å¯†é’¥ ID æ ¼å¼

```
keyId = BCS.encode(end_time: u64)
```

å®Œæ•´çš„å¯†é’¥æ ‡è¯†ç¬¦ç”± Seal æœåŠ¡å™¨è‡ªåŠ¨æ·»åŠ åŒ… ID å‰ç¼€ï¼š

```
full_key_id = [package_id] + keyId
```

### è®¿é—®ç­–ç•¥å®ç°

```move
entry fun seal_approve(id: vector<u8>, c: &Clock) {
    // è§£æ keyId
    let mut bcs_data = bcs::new(id);
    let end_time = bcs::peel_u64(&mut bcs_data);
    let leftovers = bcs::into_remainder_bytes(bcs_data);

    // éªŒè¯æ ¼å¼
    assert!(leftovers.length() == 0, ENoAccess);
    
    // éªŒè¯æ—¶é—´
    assert!(clock::timestamp_ms(c) >= end_time, ENoAccess);
}
```

### åŠ å¯†è§£å¯†æµç¨‹

```
åŠ å¯†ï¼ˆç”¨æˆ·å‡ºä»·æ—¶ï¼‰ï¼š
plaintext (å‡ºä»·) â†’ Seal.encrypt(data, keyId) â†’ ciphertext

è§£å¯†ï¼ˆæ‹å–ç»“æŸåï¼‰ï¼š
ciphertext â†’ Seal.decrypt(data, keyId, proof) â†’ plaintext

å…¶ä¸­ proof æ˜¯è¯æ˜å½“å‰æ—¶é—´ >= end_time çš„å‡­è¯
```

## ğŸ“Š æ•°æ®æ¨¡å‹

### Auction å¯¹è±¡ç»“æ„

```move
public struct Auction<phantom T> has key {
    id: UID,
    creator: address,              // åˆ›å»ºè€…åœ°å€
    coin_name: String,             // ä»£å¸åç§°
    total_supply: u64,             // æ€»ä¾›åº”é‡
    winner_count: u64,             // ä¸­æ ‡è€…æ•°é‡
    strategy: u8,                  // åˆ†é…ç­–ç•¥
    start_time: u64,               // å¼€å§‹æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    end_time: u64,                 // ç»“æŸæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    encrypted_bids: vector<EncryptedBid>,  // åŠ å¯†å‡ºä»·åˆ—è¡¨
    payment_pool: Balance<SUI>,    // æ”¯ä»˜æ± 
    finalized: bool,               // æ˜¯å¦å·²å®Œæˆ
    treasury_cap: TreasuryCap<T>,  // ä»£å¸é“¸é€ æƒ
}
```

### EncryptedBid ç»“æ„

```move
public struct EncryptedBid has store, drop, copy {
    bidder: address,           // å‡ºä»·è€…åœ°å€
    encrypted_data: vector<u8>, // åŠ å¯†çš„å‡ºä»·æ•°æ®
    payment_amount: u64,       // æ”¯ä»˜çš„ä¿è¯é‡‘
}
```

### BidInfo ç»“æ„ï¼ˆè§£å¯†åï¼‰

```move
public struct BidInfo has store, drop, copy {
    bidder: address,        // å‡ºä»·è€…åœ°å€
    bid_amount: u64,        // å‡ºä»·é‡‘é¢
    payment_amount: u64,    // æ”¯ä»˜é‡‘é¢
}
```

## ğŸ¯ åˆ†é…ç­–ç•¥ç®—æ³•

### 1. TOP_N ç­–ç•¥

```
1. è§£å¯†æ‰€æœ‰å‡ºä»·
2. æŒ‰ bid_amount é™åºæ’åº
3. é€‰æ‹©å‰ winner_count ä¸ª
4. å¹³å‡åˆ†é… total_supply
```

ä¼ªä»£ç ï¼š
```python
def top_n_strategy(bids, winner_count, total_supply):
    sorted_bids = sort(bids, key=lambda x: x.bid_amount, reverse=True)
    winners = sorted_bids[:winner_count]
    token_per_winner = total_supply / winner_count
    
    for winner in winners:
        distribute(winner.address, token_per_winner)
    
    for loser in sorted_bids[winner_count:]:
        refund(loser.address, loser.payment_amount)
```

### 2. RANDOM_N ç­–ç•¥

```
1. è§£å¯†æ‰€æœ‰å‡ºä»·
2. ä½¿ç”¨é“¾ä¸Šéšæœºæ•°æˆ–å“ˆå¸Œ
3. éšæœºé€‰æ‹© winner_count ä¸ª
4. å¹³å‡åˆ†é… total_supply
```

ä¼ªä»£ç ï¼š
```python
def random_n_strategy(bids, winner_count, total_supply, seed):
    shuffled = shuffle(bids, seed)
    winners = shuffled[:winner_count]
    token_per_winner = total_supply / winner_count
    
    for winner in winners:
        distribute(winner.address, token_per_winner)
    
    for loser in shuffled[winner_count:]:
        refund(loser.address, loser.payment_amount)
```

### 3. CLOSEST_TO_AVG ç­–ç•¥

```
1. è§£å¯†æ‰€æœ‰å‡ºä»·
2. è®¡ç®—å¹³å‡å€¼ avg = sum(bids) / count(bids)
3. æŒ‰ |bid_amount - avg| å‡åºæ’åº
4. é€‰æ‹©å‰ winner_count ä¸ªï¼ˆæœ€æ¥è¿‘å¹³å‡å€¼ï¼‰
5. å¹³å‡åˆ†é… total_supply
```

ä¼ªä»£ç ï¼š
```python
def closest_to_avg_strategy(bids, winner_count, total_supply):
    avg = sum(bid.bid_amount for bid in bids) / len(bids)
    
    sorted_bids = sort(bids, key=lambda x: abs(x.bid_amount - avg))
    winners = sorted_bids[:winner_count]
    token_per_winner = total_supply / winner_count
    
    for winner in winners:
        distribute(winner.address, token_per_winner)
    
    for loser in sorted_bids[winner_count:]:
        refund(loser.address, loser.payment_amount)
```

## ğŸ”’ å®‰å…¨è®¾è®¡

### 1. æ—¶é—´éªŒè¯

- åˆ›å»ºæ‹å–æ—¶ï¼š`start_time < end_time`
- æäº¤å‡ºä»·æ—¶ï¼š`current_time >= start_time && current_time < end_time`
- å®Œæˆæ‹å–æ—¶ï¼š`current_time >= end_time`

### 2. æƒé™æ§åˆ¶

- åˆ›å»ºæ‹å–ï¼šä»»ä½•äºº
- æäº¤å‡ºä»·ï¼šä»»ä½•äººï¼ˆæ‹å–æœŸé—´ï¼‰
- å®Œæˆæ‹å–ï¼šä»…åˆ›å»ºè€…
- åˆ†é…ä»£å¸ï¼šä»…åˆ›å»ºè€…ï¼ˆæ‹å–å®Œæˆåï¼‰

### 3. çŠ¶æ€ç®¡ç†

- ä½¿ç”¨ `finalized` æ ‡å¿—é˜²æ­¢é‡å¤å®Œæˆ
- ä½¿ç”¨æ—¶é—´æˆ³ç¡®ä¿æ“ä½œæ—¶åºæ­£ç¡®
- ä½¿ç”¨ TreasuryCap æ§åˆ¶ä»£å¸é“¸é€ 

### 4. é‡‘é¢å®‰å…¨

- éªŒè¯æ”¯ä»˜é‡‘é¢ > 0
- ä½¿ç”¨ Balance ç±»å‹ç®¡ç†èµ„é‡‘æ± 
- ç¡®ä¿é€€æ¬¾é‡‘é¢ä¸è¶…è¿‡æ± å­ä½™é¢

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. é“¾ä¸Šä¼˜åŒ–

- ä½¿ç”¨ vector å­˜å‚¨å‡ºä»·ï¼ˆåŠ¨æ€æ•°ç»„ï¼‰
- ä½¿ç”¨äº‹ä»¶è€Œéå­˜å‚¨è®°å½•å†å²
- å…±äº«å¯¹è±¡æ¨¡å¼å‡å°‘æ‹¥æœ‰æƒè½¬ç§»

### 2. å‰ç«¯ä¼˜åŒ–

- SealClient å®ä¾‹å¤ç”¨
- SessionKey ç¼“å­˜å‡å°‘ç­¾åæ¬¡æ•°
- æ‰¹é‡æŸ¥è¯¢å‡å°‘ RPC è°ƒç”¨

### 3. æŸ¥è¯¢ä¼˜åŒ–

- ä½¿ç”¨äº‹ä»¶ç´¢å¼•å¿«é€Ÿæ£€ç´¢
- ç¼“å­˜å¸¸ç”¨æŸ¥è¯¢ç»“æœ
- åˆ†é¡µåŠ è½½å¤§åˆ—è¡¨

## ğŸ”„ æœªæ¥æ‰©å±•

### 1. é“¾ä¸Šè§£å¯†

åˆ©ç”¨ Seal çš„é“¾ä¸Šè§£å¯†åŠŸèƒ½ï¼š

```move
use seal::bf_hmac_encryption;

// éªŒè¯æ´¾ç”Ÿå¯†é’¥
let verified_keys = bf_hmac_encryption::verify_derived_keys(
    derived_keys,
    package_id,
    identity,
    public_keys
);

// æ‰§è¡Œè§£å¯†
let decrypted = bf_hmac_encryption::decrypt(
    encrypted_object,
    verified_keys,
    public_keys
);
```

### 2. åŠ¨æ€ç­–ç•¥

å…è®¸ç”¨æˆ·è‡ªå®šä¹‰åˆ†é…ç­–ç•¥ï¼š

```move
public struct CustomStrategy {
    weight_function: vector<u8>,  // è‡ªå®šä¹‰æƒé‡å‡½æ•°
    selection_logic: u8,          // é€‰æ‹©é€»è¾‘
}
```

### 3. å¤šè½®æ‹å–

æ”¯æŒåˆ†æ‰¹æ¬¡ã€å¤šè½®æ¬¡çš„æ‹å–ï¼š

```move
public struct MultiRoundAuction {
    rounds: vector<Round>,
    current_round: u64,
}
```

### 4. NFT æ‹å–

æ‰©å±•æ”¯æŒ NFT çš„æ‹å–ï¼š

```move
public struct NFTAuction<phantom T: key + store> {
    nfts: vector<T>,
    // ...
}
```

## ğŸ“š å‚è€ƒèµ„æ–™

- [Sui Move Book](https://move-book.com)
- [Seal Documentation](https://seal-docs.wal.app/)
- [Sui Object Model](https://docs.sui.io/concepts/object-model)
- [Time Lock Encryption Pattern](https://github.com/MystenLabs/seal/blob/main/move/patterns/sources/tle.move)

---

**æœ¬æ–‡æ¡£æŒç»­æ›´æ–°ä¸­**

